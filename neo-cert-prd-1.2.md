# 네오인증서 PRD (Product Requirements Document)

**서비스명**: 네오인증서  
**제조사**: 주식회사 네오닥터  
**문서 버전**: 1.2  

---

## 1. 제품 개요

### 1.1 제품 정의
PDO threads(미용성형용 의료기기)의 생산부터 최종 소비까지 전 과정의 이력을 추적하여 정품을 인증하는 시스템

### 1.2 핵심 특징
- **환자 개입 최소화**: 시술 후 카카오 알림톡으로 인증 결과만 수신
- **조작 단순화**: 제품 종류 선택 + 수량 입력만으로 모든 거래 처리
- **가상 식별코드**: 물리적 개별 추적이 어려운 제품 특성상 DB 기반 가상 코드로 통계적 관리

### 1.3 서비스 형태
- **1차**: 자사(네오닥터) 전용 SaaS
- **향후**: 타 제조사 확장 가능한 플랫폼으로 발전

### 1.4 장기 비전
별도 법인으로 분리하여 여러 제조사가 이용 가능한 지속가능한 SaaS 비즈니스 모델로 확장

---

## 2. 배경 및 문제 정의

### 2.1 배경
- 자사 PDO threads 제품과 유사한 형태의 제품이 시장에 존재
- 특허로 보호 중이나 형태 모방 제품으로 인한 잠재적 리스크 존재
- 타 분야(고주파 리프팅 등)에서 유사품 문제로 정품인증 도입 사례 다수
- 소포장(1파우치 2개입) 특성상 실물 인증/QR 방식 부적합

### 2.2 핵심 문제 (동등 중요도)

| 문제 | 설명 |
|------|------|
| **환자의 정보 비대칭** | 시술 전후로 제품을 직접 볼 수 없고, 정품 여부 확인 방법 전무 |
| **브랜드 가치 보호** | R&D 투자 및 특허 확보 제품의 시장 파이를 유사품에 빼앗길 리스크 |
| **유통 이력 투명성** | 기존 월말 결산 방식의 추적 시스템으로 인한 누락 가능성 |

### 2.3 이해관계자별 현황

| 이해관계자 | 현재 문제 |
|------------|-----------|
| **환자** | 정보 비대칭 - 병원의 말을 믿을 수밖에 없는 구조 |
| **병원 (양심적)** | 일부 비양심적 병원으로 인한 시장 교란의 간접 피해 |
| **유통사** | 추가 이력 관리 업무 부담 (수용 여부 미검증) |
| **제조사** | 유사품으로 인한 시장 점유율 하락 리스크 |

---

## 3. 목표 및 성공 지표

### 3.1 비즈니스 목표
- **브랜드 신뢰도 향상**: 정품 인증을 통한 네오닥터 제품 가치 제고
- **서비스 정착**: 이용자 만족에 따른 지속적 사용 확보

### 3.2 성공 지표

| 지표 | 측정 방법 |
|------|-----------|
| **운영 효율** | 병원/유통사 피드백을 통한 지속적 개선 |
| **서비스 정착** | 실제 인증 발급 수량 추이 |

---

## 4. 타겟 사용자

### 4.1 사용자 유형

| 사용자 유형 | 역할 | 예상 인원 | 주요 액션 |
|-------------|------|-----------|-----------|
| **제조사 - 생산팀** | 생산 정보 입력 | 약 5명 | 제품 종류 등록, Lot 생산 등록 |
| **제조사 - 영업팀** | 판매 정보 입력 | (동일 조직) | 유통사/병원 출고 |
| **유통사** | 입고/출고 관리 | 2~3개사 | pending 수락, 병원/유통사 출고 |
| **병원** | 시술 후 인증 발급 | 다수 | 시술 등록, 회수, 반품 |
| **환자** | 인증 결과 수신 | - | 시스템 미사용, 알림톡만 수신 |
| **시스템 관리자** | 전체 시스템 관리 | 자사 직원 | 모니터링, 계정 관리, 이력 조회 |

### 4.2 계정 구조

#### 조직-사용자 관계
- 조직 계정 1개 : 사용자 계정 N개
- 1 사용자는 1 조직에만 연결 가능
- 모든 서비스는 조직 계정 기반으로 작동
- 그룹 계정 방식 (예: 영업팀 계정, 생산팀 계정)

#### 가입 프로세스
1. 사용자가 가입 유형 선택 (제조사/유통사/병원)
2. 사업자 등록번호 + 사업자 등록증(PDF/이미지) 입력
3. 사업자 등록번호로 기존 조직 조회
   - 조직 존재 → 해당 조직에 사용자 연결
   - 조직 미존재 → 신규 조직 생성 후 사용자 연결
4. 관리자 승인 (1차 개발에서는 임시 비활성화, 로직은 구현)

#### 권한 구조
- 초기: 조직 내 동일 권한
- 추후: 실 사용 테스트 후 권한 분리 필요성 재판단

### 4.3 UX 원칙
- **직관적 UI**: IT 역량과 무관하게 사용 가능
- **박스형 UI 선택**: 제품 선택 → 수량 입력 → 확인
- **최소 입력**: 병원 사용자의 편의성 극대화

---

## 5. 유통 구조 및 플로우

### 5.1 유통 구조
```
제조사 → 유통사 → 병원 → 환자
         ↓
       유통사 (다단계 가능)
```
- **기본**: 제조사 → 유통사 → 병원 → 환자
- **직접 판매**: 제조사 → 병원 → 환자
- **다단계 유통**: 유통사 → 유통사 가능
- **해외 확장**: 향후 현지 메신저 연동 고려

### 5.2 제품 식별 체계

#### 현재 체계의 한계
- **Lot 번호**: 동일 Lot 내 동일 번호 (개별 추적 불가)
- **UDI-DI**: 제품 종류 + 포장 단위별 동일
- **UDI-PI**: 사용기한 + Lot 번호 결합 (개별 추적 불가)

#### 해결 방안
- Lot 단위 총 수량에 **가상 일련번호** 부여 (DB 관리)
- 완전한 개별 추적은 보장하지 않으나 **통계적 관리 보장**
- **기본 FIFO 처리**: 먼저 생산된 Lot에서 우선 출고
- **Lot 선택 옵션**: 제조사 판매 시에만 특정 Lot 선택 가능 (선택사항)

### 5.3 정상 플로우

| 단계 | 주체 | 액션 | Pending | 소유권 |
|------|------|------|---------|--------|
| 생산 | 제조사 | 제품 선택 → 수량 입력 → 등록 | - | 제조사 |
| 제조사→유통사 | 제조사 | 유통사 선택 → 제품/수량 장바구니 → 출고 (Lot 선택 옵션) | O | 제조사 |
| 입고 수락 | 유통사 | pending 목록 확인 → 수락/반품 | - | 유통사 |
| 유통사→유통사 | 유통사 | 유통사 선택 → 제품/수량 장바구니 → 출고 | O | 유통사 |
| 유통사→병원 | 유통사 | 병원 선택 → 제품/수량 장바구니 → 출고 | X | 병원 |
| 제조사→병원 | 제조사 | 병원 선택 → 제품/수량 장바구니 → 출고 (Lot 선택 옵션) | X | 병원 |
| 시술 | 병원 | 제품/수량 장바구니 → 환자 전화번호 → 확인 | - | 환자 |
| 인증 | 시스템 | 알림톡 자동 발송 | - | - |

> **FIFO 처리 원칙**: 모든 출고는 기본적으로 먼저 생산된 Lot에서 우선 처리됨. 제조사만 판매 시 특정 Lot를 선택할 수 있는 옵션이 있음.

### 5.4 예외 플로우

| 시나리오 | 처리 방법 |
|----------|-----------|
| **반품 (pending 중)** | 유통사가 반품 선택 + 사유 입력 → 소유권 변경 없음 |
| **반품 (구매 확정 후)** | 유통사/병원 → 이전 판매자로 코드 반환 |
| **출고 취소** | pending 상태에서만 가능, 부분 취소 불가 (전체 취소 후 재발송) |
| **폐기** | 별도 메뉴 → 제품/수량 선택 → 사유 입력 (2차) |
| **Lot 수량 오입력** | 코드 폐기 기능으로 대응 (2차) |
| **시술 후 오입력** | 24시간 내 회수 → 환자에게 회수 알림 발송 |
| **알림톡 발송 실패** | SMS 대체 발송 (2차) |

### 5.5 Pending 데이터 접근 규칙
> **중요**: Pending 상태의 제품은 소유자는 제조사/유통사이지만, pending을 전달받은 조직이 해당 데이터를 열람 가능해야 함  
> → 구조와 로직 정의 시 명확히 고려 필요

---

## 6. 데이터 모델

### 6.1 주요 엔티티

#### 조직 (Organization)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| type | 조직 유형 (제조사/유통사/병원) | O |
| business_number | 사업자 등록번호 | O |
| business_license_file | 사업자 등록증 파일 경로 (PDF/JPG/PNG, 최대 10MB) | O |
| name | 조직명 | O |
| representative_name | 대표자명 | O |
| representative_contact | 대표 연락처 | O |
| address | 주소 | O |
| status | 상태 | O |
| created_at | 생성일시 | O |
| updated_at | 수정일시 | O |

> **파일 저장 방식**: 기본적으로 파일 스토리지에 저장하고 DB에는 경로만 저장. DB 선택에 따라 변경 가능하도록 고려.

#### 제조사 설정 (Manufacturer Settings)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| organization_id | 제조사 조직 ID | O |
| lot_prefix | Lot 번호 접두어 (기본: ND) | O |
| lot_model_digits | 모델 코드 자릿수 (기본: 5) | O |
| lot_date_format | 날짜 형식 (기본: yymmdd) | O |
| expiry_months | 사용기한 개월 수 (6개월 단위, 최대 36) | O |
| created_at | 생성일시 | O |
| updated_at | 수정일시 | O |

> **제조사별 설정**: 각 제조사는 자신만의 Lot 번호 정규식과 사용기한 설정을 가짐

#### 조직 상태 (Organization Status)
- `PENDING_APPROVAL`: 승인 대기
- `ACTIVE`: 활성
- `INACTIVE`: 비활성
- `DELETED`: 삭제됨 (데이터 보존, 복구 가능)

#### 사용자 (User)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| email | 이메일 (로그인 ID) | O |
| password | 비밀번호 (최소 6자) | O |
| name | 이름 | O |
| contact | 연락처 | O |
| department | 부서명 | X |
| organization_id | 소속 조직 ID | O |
| created_at | 생성일시 | O |
| updated_at | 수정일시 | O |

#### 제품 종류 (Product)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| organization_id | 제조사 조직 ID | O |
| name | 제품명 | O |
| udi_di | UDI-DI | O |
| model_name | 모델명 | O |
| is_active | 활성 상태 | O |
| created_at | 생성일시 | O |
| updated_at | 수정일시 | O |

> **제품-제조사 관계**: 하나의 제품은 하나의 제조사에만 속함. 최초 생산자는 단일 조직이며 변경되지 않음.  
> 추가 필드(카테고리, 이미지, 설명 등)는 2차 이후 확장 시 고려

#### Lot
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| product_id | 제품 종류 ID | O |
| lot_number | Lot 번호 (정규식 기반 자동 생성) | O |
| quantity | 생산 수량 | O |
| manufacture_date | 생산일자 | O |
| expiry_date | 사용기한 | O |
| created_at | 생성일시 | O |

#### 가상 식별코드 (Virtual Code)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| code | 가상 식별코드 (고유, 간결한 길이) | O |
| lot_id | Lot ID | O |
| status | 상태 | O |
| owner_type | 소유자 유형 (organization/patient) | O |
| owner_id | 소유자 ID (조직 ID 또는 환자 전화번호) | O |
| pending_to | pending 대상 조직 ID (nullable) | X |
| created_at | 생성일시 | O |
| updated_at | 수정일시 | O |

#### 가상 식별코드 상태 (Virtual Code Status)
- `IN_STOCK`: 재고 (생산 완료, 보유 중, 반품 후 재입고 포함)
- `PENDING`: 출고 대기 (상대방 수락 전)
- `USED`: 사용됨 (환자에게 시술)
- `DISPOSED`: 폐기됨 (2차)

> 상태값 검토 후 문제 발견 시 수정 제안 필요

#### 환자 (Patient)
| 필드 | 설명 | 필수 |
|------|------|------|
| phone_number | 전화번호 (정규화, 고유 식별자) | O |
| created_at | 최초 등록일시 | O |

> 전화번호 정규화: 하이픈 제거, 숫자만 저장 (예: 01012345678)
> 국가 코드 미포함

#### 이력 (History)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| virtual_code_id | 가상 식별코드 ID | O |
| action_type | 액션 유형 | O |
| from_owner_type | 이전 소유자 유형 | O |
| from_owner_id | 이전 소유자 ID | O |
| to_owner_type | 새 소유자 유형 | O |
| to_owner_id | 새 소유자 ID | O |
| quantity | 수량 | O |
| created_at | 일시 | O |

#### 알림 메시지 (Notification Message)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| type | 메시지 유형 (인증/회수) | O |
| patient_phone | 환자 전화번호 | O |
| content | 메시지 내용 | O |
| is_sent | 발송 여부 (1차에서는 항상 false) | O |
| created_at | 생성일시 | O |

#### 시술 기록 (Treatment Record)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| hospital_id | 병원 조직 ID | O |
| patient_phone | 환자 전화번호 | O |
| treatment_date | 시술일 | O |
| created_at | 생성일시 | O |

> **시술 기록 단위**: 한 번의 시술에서 여러 제품을 사용해도 1건의 시술로 기록됨.  
> 회수 시에도 원래 시술 건은 유지되며, 해당 식별코드만 상태가 변경됨.

#### 시술 상세 (Treatment Detail)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| treatment_id | 시술 기록 ID | O |
| virtual_code_id | 가상 식별코드 ID | O |

#### 반품 요청 (Return Request)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| requester_id | 반품 요청 조직 ID | O |
| receiver_id | 반품 수신 조직 ID (이전 소유자) | O |
| status | 상태 (PENDING/APPROVED/REJECTED) | O |
| reason | 반품 사유 | X |
| created_at | 생성일시 | O |
| updated_at | 수정일시 | O |

#### 반품 상세 (Return Detail)
| 필드 | 설명 | 필수 |
|------|------|------|
| id | 고유 식별자 | O |
| return_request_id | 반품 요청 ID | O |
| virtual_code_id | 가상 식별코드 ID | O |

> **반품 처리**: 반품 요청 시 수신자(이전 소유자)의 승인이 필요함

### 6.2 가상 식별코드 형식
- 고유한 식별 번호
- 간결한 길이 유지
- 2차 이후 암호화/압축 고려 가능

---

## 7. 기능 요구사항

### 7.1 MVP (1차 개발) 기능

#### 인증/계정 관리
- [ ] 회원가입 (제조사/유통사/병원 유형 선택)
- [ ] 로그인/로그아웃
- [ ] 비밀번호 찾기/재설정
- [ ] 비밀번호 정책: 최소 6자 (특수문자/숫자 필수 아님)
- [ ] 조직 계정 관리 (사업자 등록번호, 사업자 등록증 파일 저장)
- [ ] 사용자-조직 연결 (기존 조직 조회 → 연결 또는 신규 생성)
- [ ] 관리자 가입 승인 로직 (구현하되 초기 비활성화)
- [ ] 사업자 등록번호 형식 검증

#### 제조사 기능
- [ ] 제품 종류 등록 (제품명, UDI-DI, 모델명)
- [ ] 제품 종류 수정
- [ ] 제품 종류 비활성화 (Lot 생산 시 미노출, 이력 유지)
- [ ] Lot 번호 정규식 환경 설정
  - 구성요소별 변경 가능 (접두어, 모델코드 자릿수, 날짜 형식)
  - 예: ND→MF, 5자리→7자리, yymmdd→yyyymmdd
- [ ] 사용기한 기간 설정 (6개월 단위, 최대 3년)
- [ ] Lot 생산 등록 (자동 생성 + 수량 입력)
- [ ] 출고 (유통사/병원) - 장바구니 방식, FIFO 기본, Lot 선택 옵션
- [ ] 출고 취소 (pending 상태, 전체 취소만 가능)
- [ ] 재고 조회 (종류별 총량 / 일자별 상세)
- [ ] 거래/생산 이력 조회

#### 유통사 기능
- [ ] 입고 대기(pending) 목록 조회
- [ ] 입고 수락 (원버튼)
- [ ] 입고 반품 (사유 입력)
- [ ] 출고 (유통사/병원) - 장바구니 방식, FIFO 자동
- [ ] 출고 취소 (pending 상태, 전체 취소만 가능)
- [ ] 재고 조회
- [ ] 거래 이력 조회

#### 병원 기능
- [ ] 재고 조회
- [ ] 시술 등록 - 다중 제품 장바구니 + 환자 전화번호
- [ ] 회수 (24시간 이내, 일부 수량 가능)
- [ ] 반품 (유통사로)
- [ ] 거래 이력 조회

#### 환자 관리
- [ ] 전화번호 기반 동일 환자 인식 (정규화된 전화번호)
- [ ] 시술 이력 누적 관리

#### 관리자 기능
- [ ] 전체 조직/사용자 관리 (승인/삭제)
- [ ] 전체 이력 조회 (Excel형 테이블)
  - 필터: 기간, 현재 상태, 현재 소유자, 최초 생산자, 제품 종류
  - 결과: 식별코드, 생산일자, 현재 상태, 현재 소유자, 이동 이력
- [ ] 회수 이력 모니터링

#### 시스템/공통 기능
- [ ] FIFO 기반 식별코드 자동 할당
- [ ] 가상 식별코드 DB 자동 생성
- [ ] **카카오 알림톡 Mock 페이지**
  - 카카오톡 메시지 형태의 Mock UI
  - DB에 기록된 메시지(인증/회수) 스크롤 열람
  - 메시지 샘플 및 구성 확인용

### 7.2 2차 개발 이후 기능

| 기능 | 비고 |
|------|------|
| 카카오 알림톡 API 연동 | 실제 발송, 비즈니스 채널 개설 필요 |
| SMS 대체 발송 | 알림톡 실패 시 |
| 폐기 처리 | 제품/수량 + 사유 입력 |
| 이력 수정 | 출고 후 수량 오류 수정 |
| 출고 알림 | 시스템 메시지/이메일 |
| 환자 시술 이력 조회 페이지 | 알림톡 링크 연결 |
| 통계/리포트 | 월별 생산량, 유통사별 판매량 등 |
| 사업자등록번호 검증 API | 실제 사업자 여부 확인 |
| 개인정보 암호화 | 환자 전화번호 암호화 |
| 의료기기 규정 준수 | 관련 법규 검토 |
| 반응형 UI | 모바일/태블릿 대응 |
| Safari 지원 | 브라우저 확장 |
| 백업/복구 체계 | - |
| 부분 수락/반품 | - |
| Pending 시간 제한 | 실제 테스트 후 결정 |
| 사용기한 임박 알림 | - |
| 로그인 보안 정책 | 실패 횟수 제한, 계정 잠금 등 |
| 시스템 내 알림 | 가입 승인 완료, pending 입고 등 |

---

## 8. 사용자 스토리 / 유스케이스

### 8.1 제품 종류 등록 (제조사)
```
1. 제조사 사용자가 제품 관리 메뉴 접속
2. "제품 등록" 클릭
3. 제품명, UDI-DI, 모델명 입력
4. 등록 완료
```

### 8.2 Lot 생산 등록 (제조사)
```
1. 생산 등록 메뉴 접속
2. 제품 종류 선택 (박스형 UI, 비활성화 제품 미노출)
3. 수량 입력
4. 자동 생성 항목 확인/수정
   - Lot 번호: 환경설정 정규식 기반 (기본: ND + 모델숫자5자리 + yymmdd)
   - 생산일자: 현재 날짜 (수정 가능)
   - 사용기한: 생산일 + 설정기간 (수정 가능)
5. 등록 확인 → DB에 수량만큼 고유 식별번호 자동 생성
```

### 8.3 출고 (제조사)
```
1. 출고 메뉴 접속
2. 대상 조직(유통사/병원) 선택
3. 제품 종류 선택
4. (선택사항) 특정 Lot 선택 - 미선택 시 FIFO 자동 처리
5. 수량 입력 → 장바구니에 담기
6. 필요한 만큼 3-5 반복
7. 장바구니 확인 → 최종 출고 결정
8. 식별코드가 pending 상태로 전환 (병원 대상 시 즉시 이전)
```

### 8.4 출고 (유통사)
```
1. 출고 메뉴 접속
2. 대상 조직(유통사/병원) 선택
3. 제품 종류 선택
4. 수량 입력 → 장바구니에 담기 (FIFO 자동 처리)
5. 필요한 만큼 3-4 반복
6. 장바구니 확인 → 최종 출고 결정
7. 식별코드 상태 전환
```

### 8.5 입고 수락/반품 (유통사)
```
1. 입고 대기 메뉴 접속 (pending 제품만 표시)
2. pending 제품 목록 확인
3. 제품 선택
4. 수락 또는 반품 결정
   - 수락: 원버튼 클릭 → 소유권 이전
   - 반품: 반품 사유 입력 → 소유권 유지
```

### 8.6 출고 취소 (제조사/유통사)
```
1. 출고 이력 또는 pending 관리 메뉴 접속
2. 취소할 출고 건 선택 (pending 상태만 가능)
3. 취소 확인 → 소유권 복귀, pending 해제
※ 부분 취소 불가 - 전체 취소 후 재발송
```

### 8.7 시술 등록 (병원)
```
1. 시술 등록 메뉴 접속
2. 제품 종류 선택 → 수량 입력 → 장바구니에 담기
3. 여러 제품 사용 시 반복
4. 환자 전화번호 입력
5. 확인 → 소유권 환자에게 이전 (전화번호가 소유자 ID)
6. DB에 알림톡 메시지 기록 (1차: Mock 페이지에 표시)
```

### 8.8 회수 (병원)
```
1. 시술 이력 메뉴 접속
2. 회수할 시술 건 선택 (메시지 발송 시점부터 24시간 이내만 가능)
3. 회수할 제품 종류 및 수량 선택 (일부 가능)
4. 회수 사유 입력
5. 확인 → 소유권 병원으로 복귀
6. 환자에게 회수 알림 발송 (Mock 페이지에 기록)
7. 관리자에게 회수 이력 기록
※ 24시간 경과 시: "24시간 경과하여 처리할 수 없습니다. 관리자에게 연락해주세요."
```

### 8.9 재고 조회 (전체)
```
1. 재고 조회 메뉴 접속
2. 필터 설정
   - 제품 종류 선택 (드롭다운, 직접입력 불가)
   - Lot 번호 선택 (선택한 제품 내에서, 직접입력 불가)
   - 기간 필터
3. 메인 뷰: 제품 종류별 총 재고량 확인
4. 제품 선택 → 상세 뷰: 일자별(구매/생산일) 수량 확인
```

### 8.10 거래 이력 조회 (조직별)
```
1. 이력 조회 메뉴 접속
2. 필터 설정
   - 기간 필터
   - 거래 유형 (출고/입고/시술 등)
   - 상대 조직
3. 자신의 거래/생산 이력 확인
```

### 8.11 이력 조회 (관리자)
```
1. 이력 조회 메뉴 접속
2. 필터 설정
   - 제조사 선택
   - 제품 종류 다중 선택
   - 기간, 상태, 소유자, 최초 생산자 등
3. 조회 실행
4. Excel형 테이블로 결과 확인 (무한 스크롤)
   - 개별 식별코드, 생산일자, 현재 상태, 현재 소유자, 이동 이력
```

---

## 9. 화면 구조

### 9.1 URL 구조

#### 공용 페이지
```
/login              - 로그인
/register           - 회원가입
/forgot-password    - 비밀번호 찾기
/reset-password     - 비밀번호 재설정
/mock/kakao         - 카카오 알림톡 Mock 페이지
```

#### 제조사 페이지
```
/manufacturer/dashboard     - 대시보드
/manufacturer/products      - 제품 관리
/manufacturer/production    - 생산 등록
/manufacturer/shipment      - 출고
/manufacturer/inventory     - 재고 조회
/manufacturer/history       - 이력 조회
/manufacturer/settings      - 환경 설정 (Lot 정규식, 사용기한)
```

#### 유통사 페이지
```
/distributor/dashboard      - 대시보드
/distributor/receiving      - 입고 (pending)
/distributor/shipment       - 출고
/distributor/inventory      - 재고 조회
/distributor/history        - 이력 조회
```

#### 병원 페이지
```
/hospital/dashboard         - 대시보드
/hospital/treatment         - 시술 등록
/hospital/inventory         - 재고 조회
/hospital/history           - 이력 조회
/hospital/return            - 반품
```

#### 관리자 페이지
```
/admin/dashboard            - 대시보드
/admin/organizations        - 조직 관리
/admin/users                - 사용자 관리
/admin/approvals            - 가입 승인
/admin/history              - 전체 이력 조회
/admin/recalls              - 회수 이력
```

### 9.2 대시보드 표시 정보

| 항목 | 설명 |
|------|------|
| 총 재고량 | 현재 보유 중인 총 재고 수량 |
| 오늘 생산량 | 당일 생산 등록된 수량 (제조사) |
| 오늘 출고량 | 당일 출고된 수량 |
| 승인 대기 건수 | pending 상태 입고 건수 (유통사) |

### 9.3 목록 페이지네이션
- **무한 스크롤** 방식 적용

---

## 10. 알림톡 메시지 정의

### 10.1 정품 인증 발급

```
[네오인증서] 정품 인증 완료

안녕하세요.
{시술일}에 {병원명}에서 시술받으신 
제품의 정품 인증이 완료되었습니다.

■ 시술 정보
- 제품: {제품명} {수량}개
- 제조사: {제조사명}
- 시술일: {시술일}
- 시술 병원: {병원명}

본 제품은 정품임이 확인되었습니다.
```

**포함 항목**: 제품명, 수량, 제조사명, 시술일, 병원명  
**미포함 항목**: Lot 번호, 사용기한, 제조일

### 10.2 회수 알림

```
[네오인증서] 정품 인증 회수 안내

안녕하세요.
{병원명}에서 발급한 정품 인증이 
회수되었음을 안내드립니다.

■ 회수 정보
- 병원: {병원명}
- 회수 사유: {회수사유}
- 회수 제품: {제품명} {수량}개

문의사항은 해당 병원으로 연락해주세요.
```

**필수 포함 항목**: 병원명, 회수 사유, 회수 제품 종류, 수량

---

## 11. 에러 메시지 정의

| 상황 | 에러 메시지 |
|------|-------------|
| 로그인 실패 | 이메일 또는 비밀번호가 올바르지 않습니다. |
| 권한 없음 | 해당 기능에 대한 접근 권한이 없습니다. |
| 재고 부족 (수량 0) | 재고가 부족합니다. 현재 재고: 0개 |
| 재고 부족 (초과 입력) | 보유 수량을 초과할 수 없습니다. 현재 재고: {n}개 |
| 중복 데이터 | 이미 등록된 {항목}입니다. |
| 회수 시간 초과 | 24시간 경과하여 처리할 수 없습니다. 관리자에게 연락해주세요. |
| 잘못된 입력값 | {필드명}을(를) 올바르게 입력해주세요. |
| 사업자등록번호 형식 오류 | 사업자등록번호 형식이 올바르지 않습니다. |
| 파일 크기 초과 | 파일 크기는 10MB를 초과할 수 없습니다. |
| 파일 형식 오류 | PDF, JPG, PNG 파일만 업로드 가능합니다. |
| 서버 오류 | 서버 오류가 발생했습니다. 잠시 후 다시 시도해주세요. |
| 출고 취소 불가 | pending 상태에서만 출고를 취소할 수 있습니다. |

---

## 12. 비기능 요구사항

### 12.1 MVP (1차) 요구사항

| 항목 | 요구사항 |
|------|----------|
| **동시 사용자** | 최대 100명 (향후 확장 가능) |
| **데이터 규모** | 월 생산량 20,000 파우치 / 시술 3,000건 (향후 확장 가능) |
| **응답 시간** | 최대한 빠르게 |
| **사용 환경** | PC 위주 |
| **브라우저** | Chrome, Edge 완벽 지원 |
| **가용성** | 24시간 운영 |

### 12.2 2차 개발 이후 요구사항

| 항목 | 요구사항 |
|------|----------|
| 개인정보 보호 | 환자 전화번호 암호화 등 표준 준수 |
| 의료기기 규정 | 관련 법규 검토 및 준수 |
| 반응형 UI | 모바일/태블릿 해상도 대응 |
| 브라우저 확장 | Safari 지원 |
| 백업/복구 | 백업 주기 및 복구 시간 목표 정의 |

---

## 13. 제약 조건 및 가정

### 13.1 기술적 제약 조건

| 항목 | 내용 |
|------|------|
| **기술 스택** | 개발 진행 시 선택 (현대적이고 유려한 UI, 안정적 환경) |
| **데이터베이스** | 개발 진행 시 선택 |
| **클라우드/인프라** | 개발 진행 시 선택 (추후 변경 가능) |
| **인증 방식** | 개발 진행 시 선택 (JWT/세션 등) |

### 13.2 기본 가정

| 항목 | 내용 |
|------|------|
| **유통사/병원 협조** | 별도 협의 필요. 시범운영을 위한 참여 섭외 가능 환경 |
| **인터넷 환경** | 모든 사용자가 안정적인 인터넷 환경에서 사용 |

### 13.3 초기 데이터

#### 관리자 계정
- 개발 과정에서 직접 생성
- 페이지를 통한 관리자 계정 생성 불가

#### 테스트 조직 및 사용자

| 조직 유형 | 개수 | 사용자 수 |
|-----------|------|-----------|
| 제조사 | 1개 | 1명 |
| 유통사 | 1개 | 1명 |
| 병원 | 1개 | 1명 |

#### 테스트 계정 정보 (권장)

**관리자**
- 이메일: `admin@neocert.com`
- 비밀번호: `admin123`

**제조사**
- 조직명: 테스트제조사
- 사용자 이메일: `manufacturer@neocert.com`
- 비밀번호: `test123`

**유통사**
- 조직명: 테스트유통사
- 사용자 이메일: `distributor@neocert.com`
- 비밀번호: `test123`

**병원**
- 조직명: 테스트병원
- 사용자 이메일: `hospital@neocert.com`
- 비밀번호: `test123`

> 샘플 제품 데이터는 제외 (테스트 시 직접 등록)

---

## 14. 리스크 및 의존성

### 14.1 예상 리스크

| 리스크 | 설명 | 영향도 | 대응 방안 |
|--------|------|--------|-----------|
| **유통사/병원 참여 저조** | 추가 업무 부담으로 인한 사용 거부 | 높음 | 시범운영 피드백 반영, UX 최적화 |
| **FIFO 불일치** | 실제 물리적 출고와 시스템 기록 불일치 | 중간 | 통계적 보장 원칙 안내, Lot 내 추적 한정 |
| **환자 전화번호 오입력** | 잘못된 번호로 인증 발송 | 중간 | 24시간 내 회수 기능, 입력 확인 단계 |
| **데이터 무결성** | 수량 오입력, 중복 처리로 재고 불일치 | 높음 | 보유 수량 초과 전송 방지, 트랜잭션 처리 |
| **조직 간 데이터 혼선** | 타 조직 데이터 접근/수정 | 높음 | 조직 기반 데이터 격리, 권한 검증, pending 접근 규칙 명확화 |
| **시스템 장애** | 24시간 운영 중 장애 발생 | 높음 | 2차에서 백업/복구 체계 구축 |

### 14.2 외부 의존성

| 항목 | 시점 | 비고 |
|------|------|------|
| 카카오 알림톡 API | 2차 | 비즈니스 채널 개설 필요 |
| 사업자등록번호 검증 API | 2차 | 1차에서는 형식만 검증 |

---

## 15. 비즈니스 로직 상세

### 15.1 FIFO 처리 규칙
- **기본 원칙**: 모든 출고는 먼저 생산된 Lot에서 우선 처리
- **Lot 선택 옵션**: 제조사만 판매 시 특정 Lot 선택 가능 (선택사항)
- **Lot 내 처리**: 선택된 Lot 내에서도 생성 순서대로 FIFO 처리

### 15.2 수량 검증 규칙
- 보유 수량 = 0일 때 출고 시도 → 즉시 에러 표시
- 보유 수량 초과 입력 → 입력 후 검증 에러 표시

### 15.3 출고 취소 규칙
- pending 상태에서만 가능
- 부분 취소 불가 (전체 취소 후 재발송으로 대응)

### 15.4 회수 규칙
- 기준 시점: 환자에게 메시지 발송 처리된 시점
- 제한 시간: 24시간
- 범위: 일부 수량만 회수 가능
- 시술 건 유지: 회수해도 원래 시술 기록은 유지, 해당 식별코드 상태만 변경

### 15.5 전화번호 정규화
- 형식: 숫자만 저장 (하이픈 제거)
- 예: 010-1234-5678 → 01012345678
- 국가 코드 미포함

### 15.6 환자 소유권
- 시술 완료 시 해당 식별코드의 소유자를 환자 전화번호로 설정
- 동일 전화번호는 동일 환자로 인식, 시술 이력 누적

### 15.7 장바구니 처리
- **영속성**: DB 저장 없음, 해당 페이지 세션 내에서만 일시 유지
- **중복 담기**: 같은 제품을 여러 번 담으면 합산하여 표시
- **수량 수정**: 장바구니에 담은 후 수량 수정 가능

### 15.8 반품 처리
- **반품 대상 결정**: 각 식별코드의 이력에서 이전 소유자에게 자동으로 반품 처리
- **부분 반품**: 구매한 수량 중 일부만 반품 가능
- **승인 필요**: 반품 요청 시 수신자(이전 소유자)의 승인 필요

### 15.9 Pending 정보
유통사가 pending 목록에서 확인할 수 있는 정보:
- 제품 종류
- 수량
- 발송일
- 발송 조직
- UDI-DI

### 15.10 목록 정렬 기본값
- **재고 목록**: 제품명 순
- **이력 목록**: 최신순
- **Pending 목록**: 오래된 순 (먼저 도착한 것 우선 표시)

### 15.11 동시성 처리
- 같은 조직의 여러 사용자가 동시에 같은 제품 출고 시도 시:
  1. 먼저 시도된 건이 완료될 때까지 lock 처리
  2. 첫 번째 건 완료 후 수량 확인
  3. 수량 충분 시 다음 건 진행, 부족 시 에러 메시지 출력

### 15.12 세션 관리
- **자동 로그아웃**: 1차에서는 없음
- **중복 로그인**: 1차에서는 제한 없음 (2차에서 단일 세션 강제, 기존 세션 자동 로그아웃 + 알림)
- **관리자 계정**: 개발 과정에서 직접 생성, 페이지를 통한 관리자 계정 생성 불가

---

## 16. 용어 정의

| 용어 | 정의 |
|------|------|
| **PDO threads** | 미용성형에 사용되는 의료기기 제품 (리프팅 실) |
| **Lot** | 동일 조건에서 생산된 제품 그룹 |
| **UDI-DI** | 의료기기 고유식별코드 - 제품 종류 + 포장 단위별 동일 |
| **UDI-PI** | 의료기기 생산식별코드 - 사용기한 + Lot 번호 결합 |
| **가상 식별코드** | DB에서 관리되는 개별 제품 추적용 고유 번호 |
| **Pending** | 출고되었으나 수신자가 아직 수락하지 않은 상태 |
| **FIFO** | First In First Out - 먼저 생산된 제품이 먼저 출고 |

---

## 17. 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | - | 최초 작성 | - |
| 1.1 | - | 개발용 상세 정의 추가 (데이터 모델, 화면 구조, 비즈니스 로직 등), FIFO 로직 수정 | - |
| 1.2 | - | 개발 계획 수립용 상세 추가: 제조사 설정 엔티티, 시술 기록/반품 요청 엔티티, 장바구니/반품/동시성 처리 로직, 정렬 기본값, 세션 관리, 테스트 계정 상세 | - |

---

## 18. 승인

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| 작성자 | | | |
| 검토자 | | | |
| 승인자 | | | |
